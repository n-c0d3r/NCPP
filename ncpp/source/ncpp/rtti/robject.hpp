#pragma once

/**
 *  @file ncpp/rtti/robject.hpp
 *  @brief Implements reflected object.
 */



 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



#pragma region Includes

////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////

#include <ncpp/prerequisites.hpp>

////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////

#include <ncpp/utilities/.hpp>
#include <ncpp/containers/.hpp>
#include <ncpp/dop/.hpp>
#include <ncpp/pac/.hpp>

////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////

#include <ncpp/rtti/rclass.hpp>

#pragma endregion 



 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



namespace ncpp {

    namespace rtti {

        class robject_i;



        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



#define NCPP_RCLASS(ClassName) \
        private:\
            using current_rclass = ClassName;\
        public:\
            virtual ncpp::rtti::rclass_t<ncpp::rtti::robject_i> get_rclass(){\
                \
                return ncpp::rtti::rclass_t<ClassName>();\
            }\
            static inline ncpp::rtti::rclass_t<ClassName> get_static_rclass() {\
                \
                return ncpp::rtti::rclass_t<ClassName>(); \
            }

#define NCPP_REFLECT_CLASS(ClassName) \
        ncpp::rtti::robject_constructor_scope __robject_constructor_scope__(*this);

#define NCPP_RCVARIABLE(MemberType, MemberName, ...) \
        MemberType MemberName;\
        char MemberName##_name_cstr[sizeof(#MemberName)] = #MemberName;\
        using MemberName##_args_type = typename ncpp::rtti::robject_member_args_t<__VA_ARGS__>;\
        MemberName##_args_type MemberName##_args = {__VA_ARGS__}; \
        using MemberName##_reflecter_type = ncpp::rtti::robject_variable_reflecter_t<\
            current_rclass, \
            MemberType, \
            decltype(&current_rclass::MemberName##_name_cstr),\
            &current_rclass::MemberName##_name_cstr,\
            decltype(&current_rclass::MemberName##_args),\
            &current_rclass::MemberName##_args,\
            decltype(&current_rclass::MemberName),\
            &current_rclass::MemberName\
        >; \
        friend class MemberName##_reflecter_type; \
        MemberName##_reflecter_type MemberName##_reflecter;

#define NCPP_RCFUNCTION(MemberFunctionType, MemberName,...) \
        using MemberName##_type = MemberFunctionType; \
        MemberName##_type MemberName; \
        char MemberName##_name_cstr[sizeof(#MemberName)] = #MemberName;\
        typename ncpp::rtti::robject_member_args_t<__VA_ARGS__> MemberName##_args = {__VA_ARGS__}; \
        using MemberName##_reflecter_type = ncpp::rtti::robject_function_reflecter_t<\
            current_rclass, \
            MemberFunctionType, \
            decltype(&current_rclass::MemberName##_name_cstr),\
            &current_rclass::MemberName##_name_cstr,\
            decltype(&current_rclass::MemberName##_args),\
            &current_rclass::MemberName##_args,\
            decltype(&current_rclass::MemberName), \
            &current_rclass::MemberName \
        >; \
        friend class MemberName##_reflecter_type; \
        MemberName##_reflecter_type MemberName##_reflecter;



        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



        template<sz... args__>
        using robject_member_args_t = typename std::array<sz, sizeof... (args__)>;



        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



        robject_i& current_constructing_object();



        class robject_constructor_scope {

            friend class robject_i;



        private:
            utilities::lref_t<robject_i> prev_robject_ref_;
            utilities::lref_t<robject_i> target_robject_ref_;



        public:
            robject_constructor_scope(robject_i& robject_);
            inline robject_constructor_scope() :
                robject_constructor_scope(*utilities::lref_t<robject_i>())
            {



            }
            ~robject_constructor_scope();

        };



        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



        struct robject_member_handle {

            struct args_array_type {

                sz* head_arg_p = 0;
                sz arg_count = 0;

                inline const sz& head() const {

                    return *head_arg_p;
                }
                inline const sz& tail() const {

                    return *(head_arg_p + arg_count - 1);
                }
                inline const sz* begin() const {

                    return head_arg_p;
                }
                inline const sz* end() const {

                    return head_arg_p + arg_count;
                }

            };



            args_array_type args_array;

        };



        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



        struct robject_variable_handle : 
            public robject_member_handle
        {

            robject_i* robject_p;
            void* variable_p;



            template<typename type__>
            type__& get_t() {

                return *((type__*)variable_p);
            }
            template<typename type__>
            const type__& get_t() const {

                return *((const type__*)variable_p);
            }

            template<typename type__, typename target_type>
            void set_t(target_type target) {

                *((type__*)variable_p) = std::forward<target_type>(target);
            }

        };



        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



        struct robject_function_handle :
            public robject_member_handle
        {

            using rfunc_executer_type = void*;

            robject_i* robject_p = 0;
            rfunc_executer_type rfunc_executer;



            template<typename function_type__>
            inline std::function<function_type__>& get_t() {

                using func_ptr_type = std::function<function_type__>*;

                return *reinterpret_cast<func_ptr_type>(rfunc_executer);
            }

        };



        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



        template<
            class object_type__,
            typename variable_type__,
            typename name_member_ptr_type,
            name_member_ptr_type name_member_ptr,
            typename args_member_ptr_type,
            args_member_ptr_type args_member_ptr,
            typename member_ptr_type,
            member_ptr_type member_ptr
        >
        class robject_variable_reflecter_t
        {

        public:
            robject_variable_reflecter_t();
            ~robject_variable_reflecter_t();

        };



        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



        template<
            class object_type__,
            typename function_type__,
            typename name_member_ptr_type,
            name_member_ptr_type name_member_ptr,
            typename args_member_ptr_type,
            args_member_ptr_type args_member_ptr,
            typename member_ptr_type,
            member_ptr_type member_ptr
        >
        class robject_function_reflecter_t
        {

        public:
            typedef void* executer_type;



        public:
            robject_function_reflecter_t();
            ~robject_function_reflecter_t();

            template<b8 is_void_return__>
            struct executer_get_t;

        };



        template<
            class object_type__,
            typename function_type__,
            b8 is_void_return__,
            typename name_member_ptr_type,
            name_member_ptr_type name_member_ptr,
            typename args_member_ptr_type,
            args_member_ptr_type args_member_ptr,
            typename member_ptr_type,
            member_ptr_type member_ptr
        >
        struct robject_function_reflecter_executer_get_t {

        };



        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////





        /**
         *  Reflected object interface.
         */
        class robject_i {

            NCPP_RCLASS(robject_i);

            ////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////

        public:
            using name_to_variable_map_type = typename containers::native_unordered_map_t<containers::native_string, robject_variable_handle>;
            using name_to_function_handle_map_type = typename containers::native_unordered_map_t<containers::native_string, robject_function_handle>;

            ////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////

        private:
            name_to_variable_map_type name_to_variable_map_;
            name_to_function_handle_map_type name_to_function_handle_map_;
            robject_constructor_scope constructor_scope_;

        public:
            NCPP_RCVARIABLE(
                containers::native_string, name
            );

			////////////////////////////////////////////////////////////////////////////////////
			////////////////////////////////////////////////////////////////////////////////////
			////////////////////////////////////////////////////////////////////////////////////

#pragma region Constructors, Destructor and Operators
		public:
            robject_i();
            ~robject_i();
#pragma endregion

			////////////////////////////////////////////////////////////////////////////////////
			////////////////////////////////////////////////////////////////////////////////////
			////////////////////////////////////////////////////////////////////////////////////

#pragma region Methods
		public:
            inline void add_rvariable_handle(const containers::native_string& var_name, const robject_variable_handle& var) {

                name_to_variable_map_[var_name] = var;

            }
            inline robject_variable_handle& get_rvariable_handle(const containers::native_string& var_name) {

                return name_to_variable_map_[var_name];
            }
            template<typename variable_type__>
            inline variable_type__& get_rvariable_t(const containers::native_string& var_name) {

                return get_rvariable_handle(var_name).get_t<variable_type__>();
            }

            inline void add_rfunction_handle(const containers::native_string& func_name, robject_function_handle func_handle) {

                name_to_function_handle_map_[func_name] = func_handle;

            }
            inline robject_function_handle& get_rfunction_handle(const containers::native_string& func_name) {

                return name_to_function_handle_map_[func_name];
            }
            template<typename function_type__>
            inline std::function<function_type__>& get_rfunction_t(const containers::native_string& func_name) {

                return get_rfunction_handle(func_name).get_t<function_type__>();
            }
#pragma endregion

        };




        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



        template<
            class object_type__,
            typename variable_type__,
            typename name_member_ptr_type,
            name_member_ptr_type name_member_ptr,
            typename args_member_ptr_type,
            args_member_ptr_type args_member_ptr,
            typename member_ptr_type,
            member_ptr_type member_ptr
        >
        robject_variable_reflecter_t<
            object_type__,
            variable_type__,
            name_member_ptr_type,
            name_member_ptr,
            args_member_ptr_type,
            args_member_ptr,
            member_ptr_type,
            member_ptr
        >::robject_variable_reflecter_t() {

            object_type__& robj = (object_type__&)current_constructing_object();

            robject_variable_handle rvar_handle;
            rvar_handle.args_array = {
                (robj.*args_member_ptr).data(),
                (robj.*args_member_ptr).size()
            };
            rvar_handle.robject_p = &robj;
            rvar_handle.variable_p = &(robj.*member_ptr);

            robj.add_rvariable_handle(robj.*name_member_ptr, rvar_handle);

        }

        template<
            class object_type__,
            typename variable_type__,
            typename name_member_ptr_type,
            name_member_ptr_type name_member_ptr,
            typename args_member_ptr_type,
            args_member_ptr_type args_member_ptr,
            typename member_ptr_type,
            member_ptr_type member_ptr
        >
        robject_variable_reflecter_t<
            object_type__,
            variable_type__,
            name_member_ptr_type,
            name_member_ptr,
            args_member_ptr_type,
            args_member_ptr,
            member_ptr_type,
            member_ptr
        >::~robject_variable_reflecter_t() {



        }



        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



        template<
            class object_type__,
            typename function_type__,
            typename name_member_ptr_type,
            name_member_ptr_type name_member_ptr,
            typename args_member_ptr_type,
            args_member_ptr_type args_member_ptr,
            typename member_ptr_type,
            member_ptr_type member_ptr
        >
        robject_function_reflecter_t<
            object_type__,
            function_type__,
            name_member_ptr_type,
            name_member_ptr,
            args_member_ptr_type,
            args_member_ptr,
            member_ptr_type,
            member_ptr
        >::robject_function_reflecter_t(){

            object_type__& robj = (object_type__&)current_constructing_object();

            using function_traits = typename utilities::function_traits_t<function_type__>;

            using executer_getter_type = typename robject_function_reflecter_executer_get_t<
                object_type__,
                function_type__,
                std::is_same_v<function_traits::result_type, void>,
                name_member_ptr_type,
                name_member_ptr,
                args_member_ptr_type,
                args_member_ptr,
                member_ptr_type,
                member_ptr
            >;
                        
            executer_type rfunc_executer = executer_getter_type::get(robj);

            robject_function_handle rfunc_handle;
            rfunc_handle.args_array = {
                (robj.*args_member_ptr).data(),
                (robj.*args_member_ptr).size()
            };
            rfunc_handle.robject_p = &robj;
            rfunc_handle.rfunc_executer = reinterpret_cast<robject_function_handle::rfunc_executer_type>(rfunc_executer);

            robj.add_rfunction_handle(robj.*name_member_ptr, rfunc_handle);

        }

        template<
            class object_type__,
            typename function_type__,
            typename name_member_ptr_type,
            name_member_ptr_type name_member_ptr,
            typename args_member_ptr_type,
            args_member_ptr_type args_member_ptr,
            typename member_ptr_type,
            member_ptr_type member_ptr
        >
        robject_function_reflecter_t<
            object_type__,
            function_type__,
            name_member_ptr_type,
            name_member_ptr,
            args_member_ptr_type,
            args_member_ptr,
            member_ptr_type,
            member_ptr
        >::~robject_function_reflecter_t() {



        }

        template<
            class object_type__,
            typename function_type__,
            typename name_member_ptr_type,
            name_member_ptr_type name_member_ptr,
            typename args_member_ptr_type,
            args_member_ptr_type args_member_ptr,
            typename member_ptr_type,
            member_ptr_type member_ptr
        >
        struct robject_function_reflecter_executer_get_t <
            object_type__,
            function_type__,
            true,
            name_member_ptr_type,
            name_member_ptr,
            args_member_ptr_type,
            args_member_ptr,
            member_ptr_type,
            member_ptr
        >
        {

            using executer_type = typename robject_function_reflecter_t<
                object_type__,
                function_type__,
                name_member_ptr_type,
                name_member_ptr,
                args_member_ptr_type,
                args_member_ptr,
                member_ptr_type,
                member_ptr
            >::executer_type;

            using function_traits = typename utilities::function_traits_t<function_type__>;

            static inline executer_type get(object_type__& robj) {

                static std::function<function_type__> func_s = [&robj](auto... args) -> function_traits::result_type {

                    (robj.*member_ptr)(std::forward<decltype(args)>(args)...);

                };

                return &func_s;
            }

        };

        template<
            class object_type__,
            typename function_type__,
            typename name_member_ptr_type,
            name_member_ptr_type name_member_ptr,
            typename args_member_ptr_type,
            args_member_ptr_type args_member_ptr,
            typename member_ptr_type,
            member_ptr_type member_ptr
        >
        struct robject_function_reflecter_executer_get_t <
            object_type__,
            function_type__,
            false,
            name_member_ptr_type,
            name_member_ptr,
            args_member_ptr_type,
            args_member_ptr,
            member_ptr_type,
            member_ptr
        >
        {

            using executer_type = typename robject_function_reflecter_t<
                object_type__,
                function_type__,
                name_member_ptr_type,
                name_member_ptr,
                args_member_ptr_type,
                args_member_ptr,
                member_ptr_type,
                member_ptr
            >::executer_type;

            using function_traits = typename utilities::function_traits_t<function_type__>;

            static inline executer_type get(object_type__& robj) {

                static std::function<function_type__> func_s = [&robj](auto... args) -> function_traits::result_type {

                    return (robj.*member_ptr)(std::forward<decltype(args)>(args)...);

                };

                return &func_s;
            }

        };

    }

}